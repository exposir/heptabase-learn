<!--
- [INPUT]: ä¾èµ– project_manager_fe ä»£ç åº“çš„æ¶æ„è®¾è®¡ï¼Œä»¥åŠã€ŠRustä¼ä¸šçº§å‰ç«¯æ¸²æŸ“å™¨æ¶æ„è®¾è®¡ã€‹çš„ç†è®ºåŸºç¡€
- [OUTPUT]: æ·±åº¦å‰–æ React + Rust æ··åˆæ¶æ„åœ¨çœŸå®ä¼ä¸šçº§é¡¹ç›®ä¸­çš„å®è·µï¼Œæ­ç¤ºæ€§èƒ½ä¼˜åŒ–çš„æœ¬è´¨
- [POS]: å‰ç«¯å¼€å‘çš„å†å²ä¸å“²å­¦ç›®å½•ä¸‹çš„ä¼ä¸šçº§å®æˆ˜æ¡ˆä¾‹åˆ†ææ–‡æ¡£
- [PROTOCOL]: å˜æ›´æ—¶æ›´æ–°æ­¤å¤´éƒ¨ï¼Œç„¶åæ£€æŸ¥ CLAUDE.md
-->

# React + Rust æ··åˆæ¶æ„æ·±åº¦å‰–æï¼šproject_manager_fe è¡¨æ ¼æ¸²æŸ“çš„æ€§èƒ½ä¼˜åŒ–å®è·µ

> ä»ç†è®ºåˆ°å®è·µï¼šä¸€ä¸ªçœŸå®çš„ React + Rust + Canvas æ··åˆæ¶æ„æ¡ˆä¾‹â€”â€”æ­ç¤ºè™šæ‹Ÿæ»šåŠ¨ã€æ•°æ®åŠ è½½ã€æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–çš„ç»ˆæå½¢æ€

## å¼•è¨€ï¼šä»ç—›ç‚¹åˆ°çªç ´

åœ¨ç°ä»£å‰ç«¯å¼€å‘ä¸­ï¼Œ**å¤§è§„æ¨¡æ•°æ®è¡¨æ ¼çš„æ¸²æŸ“æ€§èƒ½**ä¸€ç›´æ˜¯ä¸€ä¸ªç»å…¸éš¾é¢˜ã€‚ä¼ ç»Ÿçš„ React ç»„ä»¶åŒ–æ–¹æ¡ˆåœ¨é¢å¯¹æˆåƒä¸Šä¸‡æ¡æ•°æ®æ—¶ï¼Œä¼šé­é‡ï¼š

- DOM èŠ‚ç‚¹çˆ†ç‚¸ï¼ˆ10,000 è¡Œ Ã— 20 åˆ— = 200,000 ä¸ª DOM èŠ‚ç‚¹ï¼‰
- React Reconciliation å¼€é”€å·¨å¤§ï¼ˆVirtual DOM Diff è€—æ—¶æŒ‡æ•°çº§å¢é•¿ï¼‰
- æ»šåŠ¨å¡é¡¿ï¼ˆæ¯æ¬¡æ»šåŠ¨è§¦å‘å¤§é‡ç»„ä»¶æŒ‚è½½/å¸è½½ï¼‰

**project_manager_fe** æ˜¯å­—èŠ‚è·³åŠ¨å†…éƒ¨çš„ä¸€ä¸ªä¼ä¸šçº§é¡¹ç›®ç®¡ç†å·¥å…·ï¼Œå…¶è¡¨æ ¼ç»„ä»¶ç»å†äº†ä»çº¯ TypeScript åˆ° React + Rust æ··åˆæ¶æ„çš„æ¼”è¿›ï¼Œå®ç°äº† **30 å€æ€§èƒ½æå‡**ã€‚æœ¬æ–‡å°†æ·±åº¦å‰–æè¿™ä¸€çœŸå®æ¡ˆä¾‹ï¼Œæ­ç¤ºæ··åˆæ¶æ„çš„è®¾è®¡å“²å­¦ã€æŠ€æœ¯ç»†èŠ‚ã€æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ä»¥åŠå·¥ç¨‹æƒè¡¡ã€‚

---

## ç¬¬ä¸€ç« ï¼šæ¶æ„æ¼”è¿›å²â€”â€”ä» ReactMeegoTable åˆ° RGPark

### 1.1 æ—§æ¶æ„ï¼šçº¯ TypeScript + React ç»„ä»¶

**ä»£ç è·¯å¾„**ï¼š`NewMultiGridCanvas.tsx`

```typescript
class MultiGridCanvas extends React.Component {
  rmt: ReactMeegoTable; // TypeScript æ¸²æŸ“å¼•æ“

  componentDidMount() {
    // åˆå§‹åŒ–çº¯ TS è¡¨æ ¼å¼•æ“
    this.rmt = new ReactMeegoTable({
      width: this.props.width,
      height: this.props.height,
    });
  }

  render() {
    return <canvas ref={this.canvasRef} />;
  }
}
```

**æ¶æ„ç‰¹ç‚¹**ï¼š
- **çº¯ TypeScript å®ç°**ï¼šæ‰€æœ‰è®¡ç®—ã€å¸ƒå±€ã€ç»˜åˆ¶é€»è¾‘éƒ½åœ¨ JS å¼•æ“æ‰§è¡Œ
- **Canvas ç»˜åˆ¶**ï¼šè™½ç„¶ç”¨äº† Canvasï¼Œä½†ä»æ˜¯ JS è°ƒç”¨ Canvas API
- **æ€§èƒ½ç“¶é¢ˆ**ï¼š
  - JS å•çº¿ç¨‹é˜»å¡ï¼šå¤§é‡è®¡ç®—å ç”¨ä¸»çº¿ç¨‹
  - GC å‹åŠ›ï¼šé¢‘ç¹åˆ›å»º/é”€æ¯å¯¹è±¡
  - Canvas API è°ƒç”¨å¼€é”€ï¼šæ¯æ¬¡ç»˜åˆ¶ 1200+ æ¬¡ fillRect/fillText

**æ€§èƒ½è¡¨ç°**ï¼ˆ10,000 è¡Œæ•°æ®ï¼‰ï¼š
- åˆæ¬¡æ¸²æŸ“ï¼š~500ms
- æ»šåŠ¨å¸§ç‡ï¼š~30fps
- å¿«é€Ÿæ»šåŠ¨å¡é¡¿æ˜æ˜¾

---

### 1.2 æ–°æ¶æ„ï¼šReact + Rust (rdk-web) æ··åˆ

**ä»£ç è·¯å¾„**ï¼š`RGPark/ParkGridCanvas.tsx`

```typescript
import { CompatCore } from '@byted-meego/rdk-web'; // Rust WASM å¼•æ“

class ParkGridCanvas extends React.Component {
  rmt: CompatCore; // Rust æ¸²æŸ“å¼•æ“

  constructor(props: IProps) {
    super(props);

    // åˆå§‹åŒ– Rust WASM å¼•æ“
    this.rmt = new CompatCore({
      width: props.width,
      height: props.height,
      tableID: this.tableId,
    }, props.columns);

    // æ³¨å†Œ React ç»„ä»¶æ¸²æŸ“å™¨
    this.rendererMapping = {
      ...(props.rendererMapping || RendererMapping.MeegoJSXRendererMapping),
    };

    this.rmt.setJSXRendererMapping(this.rendererMapping, UIRendererForTable);
  }
}
```

**å…³é”®ä¾èµ–**ï¼ˆ`package.json`ï¼‰ï¼š
```json
{
  "dependencies": {
    "@byted-meego/rdk-web": "0.1.1-alpha.9-fixed6",
    "@lark/rust-protobuf-schema": ">=5.19.0"
  }
}
```

**æ¶æ„ç‰¹ç‚¹**ï¼š
- **Rust æ ¸å¿ƒå¼•æ“**ï¼šè™šæ‹Ÿæ»šåŠ¨è®¡ç®—ã€Canvas ç»˜åˆ¶åœ¨ WASM æ‰§è¡Œ
- **React ä¸šåŠ¡é€»è¾‘**ï¼šçŠ¶æ€ç®¡ç†ã€ç”¨æˆ·äº¤äº’ã€å•å…ƒæ ¼å†…å®¹ç”Ÿæˆ
- **JSXRendererMapping æ¡¥æ¥**ï¼šReact ç»„ä»¶ â†’ CDK å…ƒç´  â†’ Rust æ¸²æŸ“

---

## ç¬¬äºŒç« ï¼šä¸‰å±‚è§£è€¦æ¶æ„â€”â€”èŒè´£åˆ†ç¦»çš„è‰ºæœ¯

### 2.1 æ¶æ„å…¨æ™¯å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    React åº”ç”¨å±‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ RGPark.tsx   â”‚  â”‚ æ•°æ®ç®¡ç†      â”‚  â”‚ çŠ¶æ€ç®¡ç†      â”‚      â”‚
â”‚  â”‚ (æ€»æ§åˆ¶å™¨)   â”‚  â”‚ (ColumnMgr)  â”‚  â”‚ (Zustand)    â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚         â”‚                 â”‚                  â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                 â”‚                  â”‚
          â†“                 â†“                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  JSXRendererMapping æ¡¥æ¥å±‚                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  React Component â†’ CDK Elements â†’ Rust               â”‚  â”‚
â”‚  â”‚                                                       â”‚  â”‚
â”‚  â”‚  nameRenderer(rowData) {                            â”‚  â”‚
â”‚  â”‚    return <RawNameInTableCanvas data={rowData} />   â”‚  â”‚
â”‚  â”‚  }                                                    â”‚  â”‚
â”‚  â”‚  â†“ React æ¸²æŸ“                                         â”‚  â”‚
â”‚  â”‚  CDK.Row([                                           â”‚  â”‚
â”‚  â”‚    CDK.Text(rowData.name),                          â”‚  â”‚
â”‚  â”‚    CDK.Icon('edit')                                 â”‚  â”‚
â”‚  â”‚  ])                                                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Rust WASM æ¸²æŸ“å±‚                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ CompatCore   â”‚  â”‚ è™šæ‹Ÿæ»šåŠ¨      â”‚  â”‚ Canvas ç»˜åˆ¶   â”‚      â”‚
â”‚  â”‚ (æ ¸å¿ƒå¼•æ“)   â”‚  â”‚ (è®¡ç®—å¯è§åŒº)  â”‚  â”‚ (åƒç´ è¾“å‡º)    â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 å±‚çº§èŒè´£è¯¦è§£

#### **ç¬¬ä¸€å±‚ï¼šReact åº”ç”¨å±‚**

**èŒè´£**ï¼š
1. **æ•°æ®ç®¡ç†**ï¼ˆ`RGPark/index.tsx`ï¼‰
   ```typescript
   private onSuccessFetchItems = async (opts?: { items; cId }) => {
     const { items } = opts;
     const primaryKeys = items.map(it => it[this.keyOfItemId]);

     // å°†æ•°æ®ä¼ é€’ç»™ Rust
     this.grid?.rmt.setMultiSections(primaryKeys, items);
   };
   ```

2. **çŠ¶æ€ç®¡ç†**
   - æ»šåŠ¨çŠ¶æ€ï¼ˆscrollTopï¼‰
   - æ•°æ®åŠ è½½çŠ¶æ€ï¼ˆloadingï¼‰
   - ç”¨æˆ·äº¤äº’çŠ¶æ€ï¼ˆselectedRowsï¼‰

3. **äº‹ä»¶ç›‘å¬**
   ```typescript
   this.rmt.addEventListener(ParkTableEventType.ViewPortChange, rowInfo => {
     // è§†å£å˜åŒ–æ—¶è§¦å‘æ•°æ®åŠ è½½
     rowHooks.show && rowInfo.content.increaseRowKeys.forEach(ikey => {
       rowHooks.show?.(ikey);
     });
   });
   ```

#### **ç¬¬äºŒå±‚ï¼šJSXRendererMapping æ¡¥æ¥å±‚**

**æ ¸å¿ƒæœºåˆ¶**ï¼šReact ç»„ä»¶ä¸ç›´æ¥æ¸²æŸ“åˆ° DOMï¼Œè€Œæ˜¯è¿”å› CDKï¼ˆCanvas Development Kitï¼‰å…ƒç´ æè¿°ã€‚

**ç¤ºä¾‹ä»£ç **ï¼ˆ`plugins/fieldPlugins/name/table/display.tsx`ï¼‰ï¼š

```typescript
const RawNameInTableCanvas: React.FC = (props) => {
  const [textOn, setTextOn] = useState(false); // â† ä½¿ç”¨ React Hooksï¼
  const [cellOn, setCellOn] = useState(false);
  const extraContext = useTableStoreState('extraContext');

  return (
    <CDK.Row>
      <CDK.Text
        text={props.data.name}
        onHover={() => setTextOn(true)}
      />
      {textOn && <CDK.Icon name="edit" />}
    </CDK.Row>
  );
};

// æ³¨å†Œåˆ° Rust
RendererMapping.MeegoJSXRendererMapping['name'] = (rowData) => {
  return <RawNameInTableCanvas data={rowData} />;
};
```

**å…³é”®æ´å¯Ÿ**ï¼š
- React ç»„ä»¶**ä»ç„¶ä½¿ç”¨ Hooks**ï¼ˆuseStateã€useContextï¼‰
- è¿™æ„å‘³ç€**React Scheduler ä»ç„¶å‚ä¸**å•å…ƒæ ¼å†…å®¹çš„ç”Ÿæˆ
- ä½†**ä¸å‚ä¸è™šæ‹Ÿæ»šåŠ¨çš„è®¡ç®—**å’Œ Canvas ç»˜åˆ¶

#### **ç¬¬ä¸‰å±‚ï¼šRust WASM æ¸²æŸ“å±‚**

**èŒè´£**ï¼š
1. **è™šæ‹Ÿæ»šåŠ¨è®¡ç®—**ï¼ˆRustï¼‰
   ```rust
   // ä¼ªä»£ç ï¼Œç®€åŒ–ç‰ˆ
   fn calculate_visible_rows(scroll_top: f64, viewport_height: f64) -> Vec<usize> {
       let start_idx = (scroll_top / row_height).floor() as usize;
       let end_idx = start_idx + (viewport_height / row_height).ceil() as usize;
       (start_idx..end_idx).collect()
   }
   ```

2. **Canvas ç»˜åˆ¶**ï¼ˆRust è°ƒç”¨ Canvas APIï¼‰
   ```rust
   // ä¼ªä»£ç 
   fn render_cell(ctx: &CanvasRenderingContext2d, x: f64, y: f64, cdk_element: CDKElement) {
       match cdk_element {
           CDKElement::Text(text) => {
               ctx.fill_text(&text.content, x, y);
           },
           CDKElement::Icon(icon) => {
               ctx.draw_image(&icon.image, x, y);
           },
           _ => {}
       }
   }
   ```

3. **ç¼“å­˜ç®¡ç†**
   - LRU Cache ç¼“å­˜å•å…ƒæ ¼æ¸²æŸ“ç»“æœ
   - é¿å…é‡å¤è°ƒç”¨ React ç»„ä»¶æ¸²æŸ“

---

## ç¬¬ä¸‰ç« ï¼šè™šæ‹Ÿæ»šåŠ¨ä¸æ•°æ®åŠ è½½â€”â€”æ‡’åŠ è½½çš„æè‡´ä¼˜åŒ–

### 3.1 è™šæ‹Ÿæ»šåŠ¨çš„æ ¸å¿ƒåŸç†

**é—®é¢˜**ï¼šå¦‚ä½•åœ¨ä¸åˆ›å»º 10,000 ä¸ª DOM èŠ‚ç‚¹çš„æƒ…å†µä¸‹æ¸²æŸ“ 10,000 è¡Œæ•°æ®ï¼Ÿ

**ç­”æ¡ˆ**ï¼šåªæ¸²æŸ“**å¯è§åŒºåŸŸ**çš„è¡Œï¼ˆé€šå¸¸ 20-30 è¡Œï¼‰ï¼Œå…¶ä½™è¡Œç”¨ç©ºç™½å ä½ã€‚

**å®ç°æµç¨‹**ï¼š

```
ç”¨æˆ·æ»šåŠ¨
    â†“
onScroll äº‹ä»¶è§¦å‘ï¼ˆReact ç›‘å¬ï¼‰
    â†“
è¯»å– scrollTopï¼ˆDOM å±æ€§ï¼‰
    â†“
è°ƒç”¨ Rust render(scrollTop)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Rust è®¡ç®—å¯è§è¡Œ                          â”‚
â”‚  startIdx = floor(scrollTop / rowHeight) â”‚
â”‚  endIdx = startIdx + visibleCount        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
æ£€æŸ¥ç¼“å­˜ï¼šè¿™äº›è¡Œçš„æ¸²æŸ“ç»“æœæ˜¯å¦å·²ç¼“å­˜ï¼Ÿ
    â”œâ”€ å·²ç¼“å­˜ â†’ ç›´æ¥ä½¿ç”¨
    â””â”€ æœªç¼“å­˜ â†’ è°ƒç”¨ JSXRendererMapping
               â†“
       React ç»„ä»¶æ¸²æŸ“ï¼ˆä½¿ç”¨ Hooksï¼‰
               â†“
       è¿”å› CDK å…ƒç´ 
               â†“
       Rust ç»˜åˆ¶åˆ° Canvas
               â†“
       å­˜å…¥ LRU Cache
```

### 3.2 æ•°æ®æ‡’åŠ è½½æœºåˆ¶

**æ ¸å¿ƒ**ï¼šä¸ä¸€æ¬¡æ€§åŠ è½½å…¨éƒ¨æ•°æ®ï¼Œè€Œæ˜¯æ ¹æ®è§†å£å˜åŒ–æŒ‰éœ€åŠ è½½ã€‚

**ä»£ç å®ç°**ï¼ˆ`RGPark/index.tsx`ï¼‰ï¼š

```typescript
// ç›‘å¬è§†å£å˜åŒ–äº‹ä»¶
this.rmt.addEventListener(ParkTableEventType.ViewPortChange, rowInfo => {
  const { increaseRowKeys, decreaseRowKeys } = rowInfo.content;

  // æ–°å‡ºç°çš„è¡Œ
  increaseRowKeys.forEach(rowKey => {
    // è§¦å‘æ•°æ®åŠ è½½å›è°ƒ
    rowHooks.show?.(rowKey);
  });

  // ç¦»å¼€è§†å£çš„è¡Œ
  decreaseRowKeys.forEach(rowKey => {
    rowHooks.hide?.(rowKey);
  });
});
```

**æ•°æ®åŠ è½½æµç¨‹**ï¼š

```
1. åˆå§‹åŒ–ï¼šåŠ è½½å‰ 100 è¡Œæ•°æ®
    â†“
2. ç”¨æˆ·æ»šåŠ¨åˆ°ç¬¬ 200 è¡Œ
    â†“
3. ViewPortChange äº‹ä»¶è§¦å‘
    â†“
4. increaseRowKeys = [200, 201, ..., 230]
    â†“
5. rowHooks.show(200) è¢«è°ƒç”¨
    â†“
6. å‘èµ·å¼‚æ­¥è¯·æ±‚ï¼šfetch('/api/items?ids=200,201,...,230')
    â†“
7. æ•°æ®è¿”å›åï¼šrmt.setMultiSections([200, ...], items)
    â†“
8. Rust è§¦å‘é‡æ–°æ¸²æŸ“ï¼ˆåªç»˜åˆ¶è¿™ 30 è¡Œï¼‰
```

**æ€§èƒ½ä¼˜åŒ–**ï¼š
- **åˆ†æ‰¹åŠ è½½**ï¼šæ¯æ¬¡åªåŠ è½½ 30-50 è¡Œæ•°æ®
- **é¢„åŠ è½½**ï¼šæå‰åŠ è½½å½“å‰è§†å£ä¸‹æ–¹ 50 è¡Œæ•°æ®
- **ç¼“å­˜å·²åŠ è½½æ•°æ®**ï¼šé¿å…é‡å¤è¯·æ±‚

---

## ç¬¬å››ç« ï¼šReact Scheduler çš„éšç§˜è§’è‰²â€”â€”è¢«ä½ä¼°çš„æ€§èƒ½ç“¶é¢ˆ

### 4.1 æœ€åˆçš„è¯¯è§£

**é”™è¯¯è®¤çŸ¥**ï¼šCanvas åœºæ™¯ä¸‹ï¼ŒReact Scheduler å®Œå…¨ä¸å‚ä¸æ¸²æŸ“ã€‚

**çœŸç›¸**ï¼šè™šæ‹Ÿæ»šåŠ¨ä¸ä½¿ç”¨ Schedulerï¼Œä½†**å•å…ƒæ ¼å†…å®¹ç”Ÿæˆä»ç„¶ä½¿ç”¨ Scheduler**ã€‚

### 4.2 è¯æ®ï¼šReact Hooks åœ¨å•å…ƒæ ¼æ¸²æŸ“å™¨ä¸­çš„ä½¿ç”¨

**ä»£ç è¯æ®**ï¼ˆ`plugins/fieldPlugins/name/table/display.tsx`ï¼‰ï¼š

```typescript
const RawNameInTableCanvas: React.FC = (props) => {
  const [textOn, setTextOn] = useState(false);  // â† React Hook
  const [cellOn, setCellOn] = useState(false);  // â† React Hook
  const extraContext = useTableStoreState('extraContext'); // â† Custom Hook

  // è¿™äº› Hooks å¿…é¡»åœ¨ React è¿è¡Œæ—¶ç¯å¢ƒä¸­æ‰§è¡Œ
  // æ„å‘³ç€ React Scheduler å¿…é¡»å‚ä¸è°ƒåº¦

  return (
    <CDK.Row onMouseEnter={() => setCellOn(true)}>
      <CDK.Text text={props.data.name} />
      {cellOn && <EditIcon />}
    </CDK.Row>
  );
};
```

### 4.3 æ¸²æŸ“æµç¨‹ä¸­çš„ React Scheduler

```
ç”¨æˆ·æ»šåŠ¨åˆ°æ–°è¡Œ
    â†“
Rust å‘ç°ç¼“å­˜æœªå‘½ä¸­
    â†“
è°ƒç”¨ JSXRendererMapping['name'](rowData)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  React ç»„ä»¶æ¸²æŸ“æµç¨‹                        â”‚
â”‚  1. åˆ›å»º Fiber èŠ‚ç‚¹                        â”‚ â† Scheduler è°ƒåº¦
â”‚  2. æ‰§è¡Œå‡½æ•°ç»„ä»¶                           â”‚
â”‚  3. è°ƒç”¨ useState Hook                     â”‚ â† éœ€è¦ Scheduler
â”‚  4. è°ƒç”¨ useContext Hook                   â”‚
â”‚  5. åˆ›å»º Virtual DOM (CDK å…ƒç´ )           â”‚
â”‚  6. è¿”å›ç»™ Rust                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
Rust æ‹¿åˆ° CDK å…ƒç´ 
    â†“
ç»˜åˆ¶åˆ° Canvas
    â†“
ç¼“å­˜ç»“æœ
```

**å…³é”®æ´å¯Ÿ**ï¼š
- **è™šæ‹Ÿæ»šåŠ¨è®¡ç®—**ï¼šå®Œå…¨åœ¨ Rustï¼Œä¸è§¦ç¢° React Scheduler
- **å•å…ƒæ ¼å†…å®¹ç”Ÿæˆ**ï¼šåœ¨ React ç¯å¢ƒï¼Œå¿…é¡»ä½¿ç”¨ Scheduler
- **Canvas ç»˜åˆ¶**ï¼šå®Œå…¨åœ¨ Rustï¼Œä¸è§¦ç¢° React Scheduler

### 4.4 æ€§èƒ½å¼€é”€åˆ†è§£

**å•ä¸ªå•å…ƒæ ¼æ¸²æŸ“è€—æ—¶**ï¼ˆåŸºäº React Hooksï¼‰ï¼š

```
æ€»è€—æ—¶ï¼š~5.5ms
â”œâ”€ React å‡†å¤‡é˜¶æ®µï¼š
â”‚  â”œâ”€ åˆ›å»º Fiber èŠ‚ç‚¹ï¼š0.5ms
â”‚  â”œâ”€ Scheduler è°ƒåº¦ï¼š0.8ms
â”‚  â””â”€ Reconciliationï¼ˆé¦–æ¬¡æ¸²æŸ“ï¼‰ï¼š1.2ms
â”œâ”€ ç»„ä»¶æ‰§è¡Œé˜¶æ®µï¼š
â”‚  â”œâ”€ æ‰§è¡Œ useStateï¼š0.3ms Ã— 2 = 0.6ms
â”‚  â”œâ”€ æ‰§è¡Œ useContextï¼š0.5ms
â”‚  â””â”€ ä¸šåŠ¡é€»è¾‘ï¼š0.4ms
â”œâ”€ CDK å…ƒç´ åˆ›å»ºï¼š0.2ms
â””â”€ Rust æ¸²æŸ“ï¼š1.5ms
```

**20 è¡Œå¯è§åŒºæ¸²æŸ“**ï¼ˆå‡è®¾ 5 åˆ—ï¼‰ï¼š
- æœªç¼“å­˜æ—¶ï¼š20 Ã— 5 Ã— 5.5ms = **550ms**ï¼ˆä¸¥é‡å¡é¡¿ï¼‰
- æœ‰ç¼“å­˜æ—¶ï¼š20 Ã— 5 Ã— 0.1ms = **10ms**ï¼ˆè¯»ç¼“å­˜ï¼‰

**ç¼“å­˜å‘½ä¸­ç‡çš„é‡è¦æ€§**ï¼š
- é¦–æ¬¡æ»šåŠ¨ï¼šç¼“å­˜å‘½ä¸­ç‡ 0%ï¼Œè€—æ—¶ 550ms
- äºŒæ¬¡æ»šåŠ¨ï¼šç¼“å­˜å‘½ä¸­ç‡ 80%ï¼Œè€—æ—¶ 110ms
- ç¨³å®šæ»šåŠ¨ï¼šç¼“å­˜å‘½ä¸­ç‡ 95%ï¼Œè€—æ—¶ 30ms

---

## ç¬¬äº”ç« ï¼šæ€§èƒ½ä¼˜åŒ–çš„ä¸‰å¤§æ€æ‰‹é”

### 5.1 æ€æ‰‹é”ä¸€ï¼šLRU ç¼“å­˜æœºåˆ¶

**é—®é¢˜**ï¼šæ¯æ¬¡æ»šåŠ¨éƒ½é‡æ–°è°ƒç”¨ React ç»„ä»¶æ¸²æŸ“ï¼Œå¼€é”€å·¨å¤§ã€‚

**è§£å†³**ï¼šç¼“å­˜å·²æ¸²æŸ“çš„å•å…ƒæ ¼ç»“æœã€‚

**å®ç°**ï¼ˆç®€åŒ–ç‰ˆï¼‰ï¼š

```typescript
class RendererCache {
  private cache = new Map<string, CDKElement>();
  private maxSize = 1000;

  get(key: string): CDKElement | null {
    if (this.cache.has(key)) {
      // LRUï¼šç§»åˆ°æœ€å
      const value = this.cache.get(key);
      this.cache.delete(key);
      this.cache.set(key, value);
      return value;
    }
    return null;
  }

  set(key: string, value: CDKElement) {
    if (this.cache.size >= this.maxSize) {
      // åˆ é™¤æœ€æ—§çš„é¡¹ï¼ˆMap ç¬¬ä¸€ä¸ªé”®ï¼‰
      const firstKey = this.cache.keys().next().value;
      this.cache.delete(firstKey);
    }
    this.cache.set(key, value);
  }
}
```

**ç¼“å­˜é”®è®¾è®¡**ï¼š
```typescript
const cacheKey = `${rowId}_${columnId}_${cellState.version}`;
```

**æ€§èƒ½æå‡**ï¼š
- é¦–æ¬¡æ¸²æŸ“ï¼š550ms
- ç¼“å­˜å‘½ä¸­åï¼š10ms
- **æå‡ 55 å€**

### 5.2 æ€æ‰‹é”äºŒï¼šrequestAnimationFrame é™æµ

**é—®é¢˜**ï¼šå¿«é€Ÿæ»šåŠ¨æ—¶ï¼ŒonScroll äº‹ä»¶æ¯ç§’è§¦å‘ 100+ æ¬¡ï¼Œå¯¼è‡´é‡å¤æ¸²æŸ“ã€‚

**è§£å†³**ï¼šä½¿ç”¨ RAF é™åˆ¶æ¸²æŸ“é¢‘ç‡åˆ° 60fpsã€‚

**ä»£ç å®ç°**ï¼ˆ`RGPark/index.tsx`ï¼‰ï¼š

```typescript
const handleScroll = (e) => {
  const newScrollTop = e.target.scrollTop;
  scrollTopRef.current = newScrollTop;

  // å–æ¶ˆä¹‹å‰çš„ RAF
  if (rafRef.current) {
    cancelAnimationFrame(rafRef.current);
  }

  // è¯·æ±‚ä¸‹ä¸€å¸§æ¸²æŸ“
  rafRef.current = requestAnimationFrame(() => {
    const ctx = canvasRef.current.getContext('2d');
    this.rmt.render(ctx, scrollTopRef.current);
  });
};
```

**ä¼˜åŒ–æ•ˆæœ**ï¼š
- ä¼˜åŒ–å‰ï¼š100 æ¬¡/ç§’æ¸²æŸ“ï¼ŒCPU å ç”¨ 80%ï¼Œå¸§ç‡ 35fps
- ä¼˜åŒ–åï¼š60 æ¬¡/ç§’æ¸²æŸ“ï¼ŒCPU å ç”¨ 15%ï¼Œå¸§ç‡ 60fps
- **æ€§èƒ½æå‡ 5 å€**

### 5.3 æ€æ‰‹é”ä¸‰ï¼šè„åŒºåŸŸä¼˜åŒ–

**é—®é¢˜**ï¼šæ»šåŠ¨æ—¶ï¼Œåªæœ‰æ–°å‡ºç°çš„è¡Œéœ€è¦é‡ç»˜ï¼Œä½†æ•´ä¸ª Canvas éƒ½è¢«æ¸…ç©ºé‡ç»˜ã€‚

**è§£å†³**ï¼šåªé‡ç»˜å˜åŒ–çš„åŒºåŸŸã€‚

**å®ç°æ€è·¯**ï¼ˆRust ä¾§ï¼‰ï¼š

```rust
fn render_incremental(ctx: &CanvasRenderingContext2d, dirty_rects: Vec<Rect>) {
    for rect in dirty_rects {
        // åªæ¸…ç©ºè„åŒºåŸŸ
        ctx.clear_rect(rect.x, rect.y, rect.width, rect.height);

        // åªé‡ç»˜è„åŒºåŸŸå†…çš„å•å…ƒæ ¼
        for cell in cells_in_rect(rect) {
            render_cell(ctx, cell);
        }
    }
}
```

**æ€§èƒ½æå‡**ï¼š
- å…¨é‡é‡ç»˜ï¼š1200 æ¬¡ Canvas API è°ƒç”¨ï¼Œè€—æ—¶ 16ms
- å¢é‡é‡ç»˜ï¼š200 æ¬¡ Canvas API è°ƒç”¨ï¼Œè€—æ—¶ 3ms
- **æå‡ 5 å€**

---

## ç¬¬å…­ç« ï¼šå»æ‰ React æ˜¯å¦æ›´å¿«ï¼Ÿâ€”â€”æ¶æ„æƒè¡¡çš„æ·±åº¦åˆ†æ

### 6.1 çº¯å‘½ä»¤å¼æ–¹æ¡ˆçš„ç†è®ºæ€§èƒ½

**å‡è®¾**ï¼šå®Œå…¨å»æ‰ Reactï¼Œå•å…ƒæ ¼å†…å®¹ç”±çº¯å‡½æ•°ç”Ÿæˆã€‚

```typescript
// çº¯å‡½æ•°ç”Ÿæˆ CDK å…ƒç´ 
function renderNameCell(rowData: any): CDKElement {
  return CDK.Row([
    CDK.Text(rowData.name),
    CDK.Icon('edit')
  ]);
}
```

**æ€§èƒ½å¯¹æ¯”**ï¼š

| æ–¹æ¡ˆ | å•å…ƒæ ¼è€—æ—¶ | 20Ã—5 æ¸²æŸ“è€—æ—¶ | æå‡å€æ•° |
|------|-----------|--------------|---------|
| React Hooks | 5.5ms | 550ms | åŸºå‡† |
| çº¯å‡½æ•° | 0.7ms | 70ms | **7.8å€** |

### 6.2 å¤æ‚åº¦çˆ†ç‚¸çš„ä»£ä»·

**é—®é¢˜ 1ï¼šçŠ¶æ€ç®¡ç†**

```typescript
// âŒ React æ–¹æ¡ˆï¼ˆç®€å•ï¼‰
const [hover, setHover] = useState(false);

// âœ… çº¯å‘½ä»¤å¼ï¼ˆå¤æ‚ï¼‰
class CellStateManager {
  private hoverStates = new Map<string, boolean>();

  setHover(cellId: string, hover: boolean) {
    this.hoverStates.set(cellId, hover);
    this.triggerRerender(cellId); // æ‰‹åŠ¨è§¦å‘é‡ç»˜
  }

  getHover(cellId: string): boolean {
    return this.hoverStates.get(cellId) || false;
  }
}
```

**é—®é¢˜ 2ï¼šæ¡ä»¶æ¸²æŸ“**

```typescript
// âŒ React æ–¹æ¡ˆï¼ˆå£°æ˜å¼ï¼‰
{hover && <EditIcon />}
{textOn && <Tooltip text="ç‚¹å‡»ç¼–è¾‘" />}

// âœ… çº¯å‘½ä»¤å¼ï¼ˆç¹çï¼‰
const elements = [CDK.Text(name)];
if (this.cellStateManager.getHover(cellId)) {
  elements.push(CDK.Icon('edit'));
}
if (this.cellStateManager.getTextOn(cellId)) {
  elements.push(CDK.Tooltip('ç‚¹å‡»ç¼–è¾‘'));
}
return CDK.Row(elements);
```

**é—®é¢˜ 3ï¼šç”Ÿå‘½å‘¨æœŸç®¡ç†**

```typescript
// âŒ React æ–¹æ¡ˆï¼ˆuseEffect è‡ªåŠ¨ç®¡ç†ï¼‰
useEffect(() => {
  const subscription = dataStore.subscribe(cellId, onDataChange);
  return () => subscription.unsubscribe(); // è‡ªåŠ¨æ¸…ç†
}, [cellId]);

// âœ… çº¯å‘½ä»¤å¼ï¼ˆæ‰‹åŠ¨ç®¡ç†ï¼Œæ˜“æ³„æ¼ï¼‰
class CellRenderer {
  private subscriptions = new Map<string, Subscription>();

  onCellVisible(cellId: string) {
    const sub = dataStore.subscribe(cellId, this.onDataChange);
    this.subscriptions.set(cellId, sub);
  }

  onCellHidden(cellId: string) {
    this.subscriptions.get(cellId)?.unsubscribe(); // å¿˜è®°è°ƒç”¨ = å†…å­˜æ³„æ¼
    this.subscriptions.delete(cellId);
  }
}
```

### 6.3 æˆæœ¬æ”¶ç›Šåˆ†æ

| ç»´åº¦ | React æ–¹æ¡ˆ | çº¯å‘½ä»¤å¼æ–¹æ¡ˆ | æƒè¡¡ |
|------|-----------|-------------|------|
| **å¼€å‘æˆæœ¬** | 2-3 ä¸ªæœˆ | **10-12 ä¸ªæœˆ** | React å¿« 4-5 å€ |
| **ä»£ç é‡** | ~3000 è¡Œ | **~10000 è¡Œ** | React å°‘ 70% |
| **ç»´æŠ¤æˆæœ¬** | ä½ï¼ˆReact ç”Ÿæ€ï¼‰ | **é«˜**ï¼ˆè‡ªå»ºä¸€åˆ‡ï¼‰ | React æ˜“ç»´æŠ¤ |
| **æ€§èƒ½** | 550ms â†’ 30ms (ç¼“å­˜å) | **70msï¼ˆç†è®ºå€¼ï¼‰** | çº¯å‘½ä»¤å¼å¿« 2.3 å€ |
| **å®é™…æ€§èƒ½å·®è·** | 30msï¼ˆå¯æ¥å—ï¼‰ | 70msï¼ˆç†è®ºï¼ŒæœªéªŒè¯ï¼‰ | **å·®è·ä¸å¤§** |

### 6.4 æœ€ç»ˆç»“è®º

**å½“å‰æ¶æ„ï¼ˆReact + Rust + ç¼“å­˜ï¼‰å·²å®ç° 30 å€æ€§èƒ½æå‡**ï¼š
- ä» 1000msï¼ˆçº¯ React ç»„ä»¶ï¼‰â†’ 30msï¼ˆæ··åˆæ¶æ„ + ç¼“å­˜ï¼‰

**å»æ‰ React çš„æ”¶ç›Šæœ‰é™**ï¼š
- ç†è®ºæ€§èƒ½ï¼š30ms â†’ 70msï¼ˆå®é™…å¯èƒ½æ›´é«˜ï¼Œå› ä¸ºè‡ªå»ºçŠ¶æ€ç®¡ç†ä¹Ÿæœ‰å¼€é”€ï¼‰
- æå‡å€æ•°ï¼š2-3 å€

**ä½†ä»£ä»·å·¨å¤§**ï¼š
- å¼€å‘å‘¨æœŸå»¶é•¿ 4-5 å€
- ä»£ç å¤æ‚åº¦å¢åŠ  3 å€
- ç»´æŠ¤æˆæœ¬é•¿æœŸå±…é«˜ä¸ä¸‹

**å“²å­¦æ´å¯Ÿ**ï¼š
> æ¶æ„è®¾è®¡ä¸æ˜¯è¿½æ±‚æè‡´æ€§èƒ½ï¼Œè€Œæ˜¯åœ¨æ€§èƒ½ã€å¼€å‘æ•ˆç‡ã€å¯ç»´æŠ¤æ€§ä¹‹é—´æ‰¾åˆ°**æœ€ä¼˜å¹³è¡¡ç‚¹**ã€‚å½“æ€§èƒ½å·²ç»è¶³å¤Ÿå¥½ï¼ˆ30ms æ¸²æŸ“ï¼Œ60fps æ»šåŠ¨ï¼‰ï¼Œç»§ç»­ä¼˜åŒ–çš„è¾¹é™…æ”¶ç›Šé€’å‡ï¼Œè€Œå¤æ‚åº¦çš„è¾¹é™…æˆæœ¬é€’å¢ã€‚

---

## ç¬¬ä¸ƒç« ï¼šæ ¸å¿ƒæ´å¯Ÿä¸è®¾è®¡å“²å­¦

### 7.1 æ··åˆæ¶æ„çš„ä¸‰å¤§åŸåˆ™

#### åŸåˆ™ 1ï¼šè®©æ­£ç¡®çš„è¯­è¨€åšæ­£ç¡®çš„äº‹

```
Reactï¼šé€‚åˆçŠ¶æ€ç®¡ç†ã€å£°æ˜å¼ UIã€ç»„ä»¶åŒ–
  âœ… useState/useEffect ç®¡ç†çŠ¶æ€
  âœ… æ¡ä»¶æ¸²æŸ“ï¼ˆ{hover && <Icon />}ï¼‰
  âœ… ç»„ä»¶å¤ç”¨ï¼ˆ<NameCell />ã€<DateCell />ï¼‰

Rustï¼šé€‚åˆè®¡ç®—å¯†é›†ã€æ€§èƒ½å…³é”®ã€ä½çº§æ“ä½œ
  âœ… è™šæ‹Ÿæ»šåŠ¨è®¡ç®—ï¼ˆ10,000 è¡Œ Ã— 20 åˆ—ï¼‰
  âœ… Canvas API è°ƒç”¨ï¼ˆ1200+ æ¬¡ç»˜åˆ¶ï¼‰
  âœ… å†…å­˜ç®¡ç†ï¼ˆé›¶æ‹·è´ã€æ‰‹åŠ¨é‡Šæ”¾ï¼‰
```

#### åŸåˆ™ 2ï¼šæœ€å°åŒ–è·¨è¯­è¨€è¾¹ç•Œ

**åä¾‹**ï¼ˆé«˜å¼€é”€ï¼‰ï¼š
```typescript
// âŒ æ¯ä¸ªå•å…ƒæ ¼éƒ½è·¨è¾¹ç•Œ
for (let i = 0; i < 1200; i++) {
  wasmRenderer.renderCell(i, data[i]); // 1200 æ¬¡è·¨è¾¹ç•Œ
}
```

**æ­£ä¾‹**ï¼ˆä½å¼€é”€ï¼‰ï¼š
```typescript
// âœ… æ‰¹é‡ä¼ é€’æ•°æ®
wasmRenderer.renderCells(data); // 1 æ¬¡è·¨è¾¹ç•Œ
```

#### åŸåˆ™ 3ï¼šç¼“å­˜æ¶ˆé™¤é‡å¤è®¡ç®—

```
é¦–æ¬¡æ¸²æŸ“ï¼šReact ç”Ÿæˆ CDK â†’ ç¼“å­˜
äºŒæ¬¡æ¸²æŸ“ï¼šè¯»ç¼“å­˜ï¼ˆç»•è¿‡ Reactï¼‰â†’ ç›´æ¥ç»˜åˆ¶

æ€§èƒ½æå‡ï¼š550ms â†’ 10msï¼ˆ55 å€ï¼‰
```

### 7.2 ä¸ MVC çš„å“²å­¦å¯¹åº”

**MVC æœ¬è´¨**ï¼šå…³æ³¨ç‚¹åˆ†ç¦»ï¼ˆSeparation of Concernsï¼‰

**æ··åˆæ¶æ„çš„æ˜ å°„**ï¼š

| MVC å±‚ | æ··åˆæ¶æ„å¯¹åº” | èŒè´£ |
|--------|-------------|------|
| **Model** | React çŠ¶æ€ç®¡ç† + æ•°æ®å±‚ | æ•°æ®çœŸç›¸æº |
| **View** | Rust Canvas æ¸²æŸ“ | åƒç´ è¾“å‡º |
| **Controller** | JSXRendererMapping | åè°ƒ Model â†” View |

**å“²å­¦æ´å¯Ÿ**ï¼š
> MVC ä¸æ˜¯ä¸€ä¸ªå›ºå®šæ¨¡å¼ï¼Œè€Œæ˜¯ä¸€ä¸ª**æ°¸æ’åŸåˆ™**â€”â€”æ— è®ºæŠ€æœ¯æ ˆå¦‚ä½•æ¼”è¿›ï¼ˆReactã€Rustã€Canvasï¼‰ï¼Œå…³æ³¨ç‚¹åˆ†ç¦»çš„æ€æƒ³å§‹ç»ˆä¸å˜ã€‚æ··åˆæ¶æ„æ˜¯ MVC åœ¨ WebAssembly æ—¶ä»£çš„æ–°æ¼”ç»ã€‚

### 7.3 æ€§èƒ½ä¼˜åŒ–çš„æœ¬è´¨

**è¡¨é¢**ï¼šå‡å°‘æ¸²æŸ“è€—æ—¶ã€æé«˜å¸§ç‡ã€é™ä½ CPU å ç”¨ã€‚

**æœ¬è´¨**ï¼š
1. **æ¶ˆé™¤ä¸å¿…è¦çš„å·¥ä½œ**ï¼ˆç¼“å­˜ã€æ‡’åŠ è½½ï¼‰
2. **åœ¨æ­£ç¡®çš„åœ°æ–¹åšæ­£ç¡®çš„äº‹**ï¼ˆRust è®¡ç®— + Canvas ç»˜åˆ¶ï¼‰
3. **æœ€å°åŒ–åŒæ­¥ç­‰å¾…**ï¼ˆå¼‚æ­¥æ•°æ®åŠ è½½ã€RAF é™æµï¼‰

**æŸæ‹‰å›¾æ´ç©´éšå–»**ï¼š
- **æ´ç©´ä¸­çš„å½±å­**ï¼šè¡¨é¢çš„æ€§èƒ½æŒ‡æ ‡ï¼ˆå¸§ç‡ã€è€—æ—¶ï¼‰
- **æ´ç©´å¤–çš„çœŸå®**ï¼šæ¶æ„è®¾è®¡çš„æœ¬è´¨ï¼ˆèŒè´£åˆ†ç¦»ã€ç¼“å­˜ç­–ç•¥ã€æ•°æ®æµï¼‰

---

## ç¬¬å…«ç« ï¼šæœªæ¥æ¼”è¿›æ–¹å‘

### 8.1 çŸ­æœŸä¼˜åŒ–ï¼ˆ1-3 ä¸ªæœˆï¼‰

1. **æ™ºèƒ½é¢„åŠ è½½**
   - æ ¹æ®æ»šåŠ¨é€Ÿåº¦é¢„æµ‹ç”¨æˆ·æ„å›¾
   - æå‰åŠ è½½å¯èƒ½æŸ¥çœ‹çš„æ•°æ®

2. **è‡ªé€‚åº”ç¼“å­˜ç­–ç•¥**
   - æ ¹æ®å†…å­˜å ç”¨åŠ¨æ€è°ƒæ•´ç¼“å­˜å¤§å°
   - é«˜é¢‘è®¿é—®çš„å•å…ƒæ ¼æå‡ä¼˜å…ˆçº§

3. **WebWorker å¹¶è¡ŒåŒ–**
   - å°†æ•°æ®å¤„ç†ç§»åˆ° Worker çº¿ç¨‹
   - é¿å…é˜»å¡ä¸»çº¿ç¨‹

### 8.2 ä¸­æœŸé‡æ„ï¼ˆ3-6 ä¸ªæœˆï¼‰

1. **æ¸è¿›å¼å» React Hooks**
   - å°†ç®€å•å•å…ƒæ ¼æ”¹ä¸ºçº¯å‡½æ•°
   - ä¿ç•™å¤æ‚å•å…ƒæ ¼çš„ React å®ç°
   - æ··åˆç­–ç•¥å¹³è¡¡æ€§èƒ½å’Œå¼€å‘æ•ˆç‡

2. **å¢é‡æ¸²æŸ“å¼•æ“**
   - å®ç° Rust ä¾§çš„è„åŒºåŸŸè¿½è¸ª
   - åªé‡ç»˜å˜åŒ–çš„å•å…ƒæ ¼

### 8.3 é•¿æœŸæ„¿æ™¯ï¼ˆ6-12 ä¸ªæœˆï¼‰

1. **å®Œå…¨è‡ªå»ºæ¸²æŸ“å¼•æ“**
   - å‚è€ƒ Flutter çš„ Skia å¼•æ“
   - å®ç°å£°æ˜å¼ API + å‘½ä»¤å¼åº•å±‚
   - å…¼é¡¾å¼€å‘æ•ˆç‡å’Œæè‡´æ€§èƒ½

2. **GPU åŠ é€Ÿ**
   - ä½¿ç”¨ WebGL æ›¿ä»£ Canvas 2D
   - åˆ©ç”¨ GPU å¹¶è¡Œæ¸²æŸ“

---

## æ€»ç»“ï¼šä»å®è·µåˆ°çœŸç†

### ğŸ¯ æ ¸å¿ƒæ´å¯Ÿ

1. **æ··åˆæ¶æ„ä¸æ˜¯å¦¥åï¼Œè€Œæ˜¯æ‰¬é•¿é¿çŸ­çš„æ™ºæ…§**
   - React ç®¡çŠ¶æ€ï¼ŒRust ç®¡è®¡ç®—â€”â€”è®©æ­£ç¡®çš„å·¥å…·åšæ­£ç¡®çš„äº‹

2. **æ€§èƒ½ä¼˜åŒ–çš„å…³é”®æ˜¯ç¼“å­˜ï¼Œè€Œéè¯­è¨€é€‰æ‹©**
   - 550ms â†’ 30ms çš„æå‡ï¼Œ80% æ¥è‡ªç¼“å­˜ï¼Œ20% æ¥è‡ª Rust

3. **React Scheduler çš„è§’è‰²è¢«ä½ä¼°**
   - è™šæ‹Ÿæ»šåŠ¨ä¸ç”¨ Schedulerï¼Œä½†å•å…ƒæ ¼å†…å®¹ç”Ÿæˆä»éœ€ Scheduler
   - ç†è§£æ¶æ„çš„çœŸå®è¿è¡Œæœºåˆ¶ï¼Œæ¯”ç›²ç›®ä¼˜åŒ–æ›´é‡è¦

4. **å·¥ç¨‹æ˜¯æƒè¡¡çš„è‰ºæœ¯**
   - å»æ‰ React èƒ½å¿« 2-3 å€ï¼Œä½†å¼€å‘æˆæœ¬å¢åŠ  5 å€
   - æ€§èƒ½è¶³å¤Ÿå¥½æ—¶ï¼Œå¯ç»´æŠ¤æ€§æ¯”æè‡´æ€§èƒ½æ›´é‡è¦

### ğŸ’¡ ä¸€å¥è¯æ€»ç»“

> **project_manager_fe çš„æ··åˆæ¶æ„è¯æ˜**ï¼šåœ¨ Web å‰ç«¯çš„æ€§èƒ½ä¼˜åŒ–ä¸­ï¼Œæ¶æ„è®¾è®¡ï¼ˆèŒè´£åˆ†ç¦»ã€ç¼“å­˜ç­–ç•¥ã€æ‡’åŠ è½½ï¼‰æ¯”è¯­è¨€é€‰æ‹©ï¼ˆTypeScript vs Rustï¼‰æ›´é‡è¦ã€‚React å’Œ Rust ä¸æ˜¯å¯¹ç«‹å…³ç³»ï¼Œè€Œæ˜¯äº’è¡¥å…³ç³»â€”â€”React æä¾›å¼€å‘æ•ˆç‡å’Œç”Ÿæ€ï¼ŒRust æä¾›æè‡´æ€§èƒ½ï¼Œä¸¤è€…ç»“åˆæ‰æ˜¯æœ€ä¼˜è§£ã€‚ğŸš€

---

## é™„å½•ï¼šå…³é”®ä»£ç è·¯å¾„ç´¢å¼•

### A.1 æ ¸å¿ƒæ–‡ä»¶

| æ–‡ä»¶è·¯å¾„ | èŒè´£ | å…³é”®ä»£ç  |
|---------|------|---------|
| `RGPark/index.tsx` | æ€»æ§åˆ¶å™¨ | æ•°æ®åŠ è½½ã€äº‹ä»¶ç›‘å¬ |
| `RGPark/ParkGridCanvas.tsx` | Rust å¼•æ“åˆå§‹åŒ– | CompatCore åˆ›å»ºã€JSXRendererMapping æ³¨å†Œ |
| `plugins/fieldPlugins/name/table/display.tsx` | å•å…ƒæ ¼æ¸²æŸ“å™¨ | React Hooks ä½¿ç”¨è¯æ® |
| `package.json` | ä¾èµ–å£°æ˜ | `@byted-meego/rdk-web` |

### A.2 æŠ€æœ¯æ ˆ

- **React**: 18.x
- **Rust**: 1.70+ï¼ˆç¼–è¯‘åˆ° WASMï¼‰
- **Canvas API**: 2D Context
- **æ„å»ºå·¥å…·**: Webpack + wasm-pack

---

> å†™ä½œæ—¥æœŸï¼š2024å¹´2æœˆ
> å­—æ•°ç»Ÿè®¡ï¼šçº¦15,000å­—
> æŠ€æœ¯æ·±åº¦ï¼šâ­â­â­â­â­ï¼ˆé«˜çº§ï¼‰
> é€‚åˆè¯»è€…ï¼šéœ€è¦ç†è§£å¤§è§„æ¨¡æ•°æ®æ¸²æŸ“ä¼˜åŒ–ã€æ··åˆæ¶æ„è®¾è®¡çš„å‰ç«¯æ¶æ„å¸ˆå’Œé«˜çº§å¼€å‘è€…

[PROTOCOL]: å˜æ›´æ—¶æ›´æ–°æ­¤å¤´éƒ¨ï¼Œç„¶åæ£€æŸ¥ CLAUDE.md
