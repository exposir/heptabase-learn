<!--
- [INPUT]: Native WebKit/WebView, JSBridge Protocols, Offline Caching Strategies, Containerization
- [OUTPUT]: 跨端移动开发架构设计与通信方案要求
- [POS]: 编程题/ 复杂场景专题，聚焦 Hybrid 混合开发与多端一致性方案
- [PROTOCOL]: 变更时更新此头部，然后检查 CLAUDE.md
-->

# 3.8 跨端场景

跨端开发不仅要追求"一套代码，多端运行"，更要解决 Web 环境与原生环境（Native）之间的通信边界与体验落差。

---

### 3.8.1 JSBridge 通信设计 ⭐⭐⭐

**要求：** 设计一套基于 Hybrid 架构的双向通信协议栈。

- **实战要素：**
  - **通信协议规范**：定义 `Native://method?params&callbackId` 的标准化调用协议。
  - **回调映射机制**：实现 JS 与 Native 异步通信的回调存储与触发逻辑。
  - **超时与异常处理**：处理 Native 响应超时或由于环境版本导致的调用失败。
  - **降级与 mock**：在普通浏览器环境中实现功能 Mock，保证业务代码的不侵入性。
  - **版本兼容管理**：通过能力检测（Feature Detection）管理 SDK 应用的版本梯度。

---

### 3.8.2 离线包方案与资源拦截 ⭐⭐⭐

**要求：** 设计并模拟一个完整的资源离线化分发与劫持流程。

- **核心环节：**
  - **分发与更新逻辑**：实现增量包下载、MD5 校验与后台静默更新流程。
  - **资源请求拦截**：WebView 侧对 HTTP 请求的拦截并映射到本地文件系统的逻辑。
  - **版本回滚能力**：应对质量故障的快速降级与多版本共存管理。

---

### 3.8.3 多端适配与抹平技术 ⭐⭐⭐

**要求：** 在跨端开发（如小程序、RN、H5）中建立一套标准化的适配工具链。

- **技术要求：**
  - **条件编译机制**：设计基于编译时环境变量的代码分支选择方案。
  - **API 抹平设计**：统一各端（如位置获取、导航控制）的异步接口调用标准。
  - **样式适配方案**：处理不同物理像素密度下（rem/px/rpx）的视觉一致性。
  - **跨端组件差异**：设计抽象化的核心组件层，支持跨 Runtime 的差异化渲染。

---

## 质量指标

- **通信延迟**：JSBridge 调用的平均耗时波动。
- **离线覆盖率**：首屏核心资源的二次打开离线化指标（P99）。
- **维护成本**：跨端方案是否提供了健壮的调试工具与模拟环境。
