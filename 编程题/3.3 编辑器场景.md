<!--
- [INPUT]: Browser Range/Selection API, DOM Structure, Collaborative Algorithms (OT/CRDT)
- [OUTPUT]: 编辑器架构设计、自定义 Block 实现及协同同步策略要求
- [POS]: 编程题/ 复杂场景专题，聚焦富文本处理与协同编辑
- [PROTOCOL]: 变更时更新此头部，然后检查 CLAUDE.md
-->

# 3.3 编辑器场景

编辑器是前端开发中最复杂的应用形式之一，它集成了数据结构、DOM 操作、事件管理及复杂的状态同步算法。

---

### 3.3.1 富文本编辑器 (Rich Text Editor) ⭐⭐⭐⭐⭐

**要求：** 设计并实现一个基于 L0/L1 层的富文本编辑器核心逻辑。

- **核心挑战：**
  - **数据模型设计**：由 DOM 驱动 (ContentEditable) 还是由数据驱动 (Model-driven) 的权衡。
  - **Selection/Range API**：跨节点的选区计算、光标定位与样式通过 `execCommand` 或手动 DOM 修改的应用。
  - **自定义 Block**：如何插入并管理非文本内容（如图片、卡片、代码块）。
  - **快捷键系统**：冲突处理与命令模式 (Command Pattern) 的集成。
  - **粘贴处理**：HTML 清洗 (Sanitize) 与多种格式（Markdown/JSON）的解析转换。
  - **协同编辑**：OT (Operational Transformation) 或 CRDT 算法在编辑器状态同步中的应用。

---

### 3.3.2 代码编辑器集成 ⭐⭐⭐

**要求：** 封装并深度定制业界主流的代码编辑器引擎。

- **实战要点：**
  - **Monaco/CodeMirror 定制**：自定义主题、扩展右键菜单及侧边栏装饰。
  - **语法高亮原理**：基于词法分析 (Lexical Analysis) 或 TextMate 语法的着色机制。
  - **代码提示与补全**：LSP (Language Server Protocol) 的前端对接。
  - **错误检查 (Diagnostics)**：实时语法分析与波浪线提示实现。

---

### 3.3.3 Markdown 编辑器 ⭐⭐⭐

**要求：** 实现一个支持实时预览与语法扩展的高性能 Markdown 编辑工具。

- **功能要求：**
  - **实时预览**：编辑与渲染的同步策略（防抖、按需更新）。
  - **语法扩展**：基于 Remark/PostHTML 的自定义语法支持。
  - **媒体处理**：拖拽/粘贴图片自动上传与链接插入。
  - **目录生成 (TOC)**：基于 Heading 节点的深度优先遍历算法。

---

## 质量指标

- **稳定性**：复杂的撤销重做 (Undo/Redo) 栈管理是否产生内存泄漏。
- **性能**：万级字符输入时的响应延迟（LCP/FID 指标）。
- **兼容性**：不同浏览器对 Range API 的碎片化实现处理。
