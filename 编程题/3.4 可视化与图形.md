<!--
- [INPUT]: Canvas API, WebGL, Geometry Algorithms, Rendering Performance Optimization
- [OUTPUT]: 图形渲染系统设计、编辑器交互及高性能可视化策略要求
- [POS]: 编程题/ 复杂场景专题，聚焦图形学、渲染管线与数据可视化
- [PROTOCOL]: 变更时更新此头部，然后检查 CLAUDE.md
-->

# 3.4 可视化与图形

可视化不仅仅是图表展示，更是对大数据量下的图形渲染效率与复杂空间交互的严苛挑战。

---

### 3.4.1 Canvas 性能优化 ⭐⭐⭐

**要求：** 针对大规模图形渲染场景，建立一套性能评估与优化方案。

- **技术挑战：**
  - **脏矩形渲染 (Dirty Rectangle)**：实现局部刷新，避免全量重绘。
  - **离屏 Canvas (OffscreenCanvas)**：利用多线程 Worker 进行预渲染。
  - **图形拾取 (Hit Testing)**：反色法 vs 空间剖分算法（Quad-Tree）实现高精度点击判定。
  - **分层渲染策略**：动静分离，优化合成层的开销。
  - **高 DPI 适配**：解决 Retina 屏下的图形模糊问题（DevicePixelRatio）。

---

### 3.4.2 图形编辑器 ⭐⭐⭐⭐

**要求：** 实现一个支持元素拖拽、缩放及连线的图形编辑系统（类似 Figma/Draw.io）。

- **核心功能：**
  - **坐标系转换**：屏幕坐标与画布坐标的线性映射逻辑。
  - **缩放平移 (Zoom/Pan)**：基于鼠标滚轮和手势的 Canvas 矩阵变换。
  - **对齐吸附 (Snapping)**：基于几何计算的辅助线与自动对齐。
  - **路径/连线算法**：实现 A\* 避障或曼哈顿布局的拓扑连线。
  - **撤销重做**：基于 Memento 模式的图形状态快照管理。

---

### 3.4.3 大数据可视化 ⭐⭐⭐⭐

**要求：** 解决单页面处理海量数据点（10w+）时的渲染崩溃与卡顿问题。

- **关键技术：**
  - **数据降采样 (Downsampling)**：LTTB 等算法在保持趋势下的数据精简。
  - **WebGL 渲染**：利用 GPU 并行计算能力分摊 CPU 压力。
  - **聚合策略 (Clustering)**：基于地理位置或坐标范围的动态聚类。
  - **渐进式渲染 (Progressive Rendering)**：分批注入数据，保证 UI 首帧响应。

---

## 质量指标

- **渲染帧率**：交互过程中是否维持 60fps。
- **内存占用**：图形对象频发创建与销毁时的 GC 管理。
- **计算精度**：大规模缩放下的浮点数精度丢失与坐标漂移处理。
